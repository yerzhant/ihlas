<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                template="../WEB-INF/templates/main.xhtml"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ez="http://xmlns.jcp.org/jsf/composite/ezcomp"
                xmlns:h="http://xmlns.jcp.org/jsf/html">

    <ui:define name="title">Главная</ui:define>

    <ui:define name="body">
        <h:form>
            <p:panelGrid columns="3">
                <p:outputLabel for="filter">Поиск:</p:outputLabel>
                <p:inputText id="filter" value="#{indigents.filter}" />
                <p:commandButton value="Найти" actionListener="#{indigents.filter()}" update="indigents:tableForm:table" icon="ui-icon-search" />
            </p:panelGrid>
        </h:form>

        <p:panel header="Нуждающиеся">
            <ez:table id="indigents" dialogHeader="Наждающийся"
                      items="#{indigents.items}" selected="#{indigents.selected}"
                      create="#{indigents.create()}" save="#{indigents.save()}" delete="#{indigents.delete()}" cancel="#{indigents.cancel()}" refresh="#{indigents.refresh()}">

                <p:column headerText="Фамилия">
                    #{item.lastName}
                </p:column>

                <p:column headerText="Имя">
                    #{item.firstName}
                </p:column>

                <p:column headerText="Отчество">
                    #{item.surname}
                </p:column>

                <p:column headerText="Дата рождения">
                    <h:outputText value="#{item.birthDate}">
                        <f:convertDateTime locale="ru"/>
                    </h:outputText>
                </p:column>

                <f:facet name="dialog">
                    <p:panelGrid columns="3">
                        <p:outputLabel for="lastName" value="Фамилия" />
                        <p:inputText id="lastName" value="#{indigents.selected.lastName}" />
                        <p:message for="lastName" />

                        <p:outputLabel for="firstName" value="Имя" />
                        <p:inputText id="firstName" value="#{indigents.selected.firstName}" />
                        <p:message for="firstName" />

                        <p:outputLabel for="surname" value="Отчество" />
                        <p:inputText id="surname" value="#{indigents.selected.surname}" />
                        <p:message for="surname" />

                        <p:outputLabel for="birthDate" value="Дата рождения" />
                        <p:calendar id="birthDate" value="#{indigents.selected.birthDate}" mask="true" pattern="dd.MM.yyyy" />
                        <p:message for="birthDate" />
                    </p:panelGrid>
                </f:facet>

            </ez:table>

            <p:panel header="Документы" toggleable="true" collapsed="true">
                <ez:table id="docs" dialogHeader="Документ"
                          items="#{indigentDocs.items}" selected="#{indigentDocs.selected}"
                          create="#{indigentDocs.create()}" save="#{indigentDocs.save()}" delete="#{indigentDocs.delete()}" cancel="#{indigentDocs.cancel()}" refresh="#{indigentDocs.refresh()}">

                    <p:column headerText="Тип">
                        #{item.docType}
                    </p:column>

                    <p:column headerText="Примечания">
                        #{item.notes}
                    </p:column>

                    <f:facet name="dialog">
                        <p:panelGrid columns="3" rendered="#{not empty indigentDocs.selected}">
                            <p:outputLabel for="docType" value="Тип" />
                            <p:selectOneMenu id="docType" value="#{indigentDocs.selected.docType}">
                                <f:selectItems value="#{docTypes.items}"
                                               var="item"
                                               itemValue="#{item}"/>
                            </p:selectOneMenu>
                            <p:message for="docType" />

                            <p:outputLabel for="notes" value="Примечания" />
                            <p:inputText id="notes" value="#{indigentDocs.selected.notes}" />
                            <p:message for="notes" />

                            <p:outputLabel for="image" value="Документ" />
                            <p:graphicImage id="image" value="#{indigentDocs.image}" cache="false" />
                            <p:message for="image" />
                        </p:panelGrid>

                        <p:fileUpload id="uploader" fileUploadListener="#{indigentDocs.handleFile}" auto="true" update="image" />
                    </f:facet>

                </ez:table>
            </p:panel>
        </p:panel>
    </ui:define>

</ui:composition>
